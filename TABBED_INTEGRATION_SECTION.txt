      {/* Integration Methods - Tabbed Interface */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Code className="h-5 w-5" />
            Integration Methods
          </CardTitle>
          <CardDescription>
            Choose the integration method that best fits your partner&apos;s technical capabilities
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Tabs value={activeIntegrationTab} onValueChange={(value) => setActiveIntegrationTab(value as 'wordpress' | 'api-key' | 'jwt')}>
            <TabsList className="grid w-full grid-cols-3">
              <TabsTrigger value="wordpress">
                <Sparkles className="h-4 w-4 mr-2" />
                WordPress Plugin
              </TabsTrigger>
              <TabsTrigger value="api-key">
                <Key className="h-4 w-4 mr-2" />
                API Key Method
              </TabsTrigger>
              <TabsTrigger value="jwt">
                <Code className="h-4 w-4 mr-2" />
                JWT Method
              </TabsTrigger>
            </TabsList>

            {/* Tab 1: WordPress Plugin */}
            <TabsContent value="wordpress" className="space-y-4 mt-6">
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6">
                <div className="flex items-start gap-4">
                  <Sparkles className="h-8 w-8 text-blue-600 mt-1" />
                  <div className="flex-1">
                    <h3 className="text-lg font-semibold text-blue-900 mb-2">WordPress Plugin - Zero Code Solution</h3>
                    <p className="text-blue-800 mb-4">
                      Perfect for WordPress users! Install our plugin and you&apos;re done. No coding required.
                    </p>
                    <div className="space-y-3">
                      <div className="flex items-center gap-2 text-sm text-blue-700">
                        <Check className="h-4 w-4" />
                        <span>Automatic user detection</span>
                      </div>
                      <div className="flex items-center gap-2 text-sm text-blue-700">
                        <Check className="h-4 w-4" />
                        <span>One-click installation</span>
                      </div>
                      <div className="flex items-center gap-2 text-sm text-blue-700">
                        <Check className="h-4 w-4" />
                        <span>Works with any WordPress theme</span>
                      </div>
                    </div>
                    <div className="mt-4 pt-4 border-t border-blue-200">
                      <p className="text-sm text-blue-600 mb-2">
                        <strong>Coming Soon!</strong> WordPress plugin download will be available here.
                      </p>
                      <Button disabled variant="outline" size="sm">
                        <Download className="h-4 w-4 mr-2" />
                        Download Plugin (Coming Soon)
                      </Button>
                    </div>
                  </div>
                </div>
              </div>
            </TabsContent>

            {/* Tab 2: API Key Method */}
            <TabsContent value="api-key" className="space-y-6 mt-6">
              {/* API Key Management */}
              <Card>
                <CardHeader>
                  <div className="flex items-center justify-between">
                    <CardTitle className="flex items-center gap-2">
                      <Key className="h-5 w-5" />
                      API Key
                    </CardTitle>
                    <Button
                      onClick={generateApiKey}
                      variant="outline"
                      size="sm"
                      disabled={generatingApiKey}
                    >
                      {generatingApiKey ? (
                        <>
                          <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                          Generating...
                        </>
                      ) : apiKey ? (
                        <>
                          <RefreshCw className="h-4 w-4 mr-2" />
                          Regenerate
                        </>
                      ) : (
                        <>
                          <Key className="h-4 w-4 mr-2" />
                          Generate API Key
                        </>
                      )}
                    </Button>
                  </div>
                  <CardDescription>
                    API key is used for simple backend token generation. Perfect for non-technical partners who can make a simple API call.
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {apiKey && apiKey !== 'exists' && showApiKey ? (
                    <div className="space-y-4">
                      <div className="flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <AlertTriangle className="h-5 w-5 text-yellow-600" />
                        <p className="text-sm text-yellow-800">
                          <strong>Important:</strong> Copy this API key now. It will not be displayed again for security reasons.
                        </p>
                      </div>
                      <div className="flex items-center gap-2">
                        <code className="flex-1 p-3 bg-gray-100 rounded-lg font-mono text-sm break-all">
                          {apiKey}
                        </code>
                        <Button
                          onClick={copyApiKey}
                          variant="outline"
                          size="sm"
                        >
                          {copiedApiKey ? (
                            <>
                              <Check className="h-4 w-4 mr-2" />
                              Copied!
                            </>
                          ) : (
                            <>
                              <Copy className="h-4 w-4 mr-2" />
                              Copy
                            </>
                          )}
                        </Button>
                      </div>
                    </div>
                  ) : apiKey === 'exists' ? (
                    <div className="space-y-2">
                      <p className="text-sm text-muted-foreground">
                        API key is configured. Click &quot;Regenerate&quot; to create a new one (this will invalidate the old key).
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-2">
                      <p className="text-sm text-muted-foreground">
                        No API key configured. Generate one to enable API key authentication.
                      </p>
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* API Key Code Examples */}
              {(apiKey && apiKey !== 'exists' && showApiKey) || apiKey === 'exists' ? (
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <FileCode className="h-5 w-5" />
                      Integration Code Examples
                    </CardTitle>
                    <CardDescription>
                      Copy these code examples and share with your partner. Replace placeholders with actual values from above.
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {/* Platform Selector */}
                    <div className="flex gap-2 border-b pb-4">
                      <Button
                        variant={selectedApiKeyPlatform === 'nodejs' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setSelectedApiKeyPlatform('nodejs')}
                      >
                        Node.js / Express
                      </Button>
                      <Button
                        variant={selectedApiKeyPlatform === 'python' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setSelectedApiKeyPlatform('python')}
                      >
                        Python / Flask
                      </Button>
                      <Button
                        variant={selectedApiKeyPlatform === 'wordpress' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setSelectedApiKeyPlatform('wordpress')}
                      >
                        WordPress (PHP)
                      </Button>
                    </div>

                    {/* Node.js Code Example */}
                    {selectedApiKeyPlatform === 'nodejs' && (
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="font-semibold mb-1">Node.js / Express Integration</h4>
                            <p className="text-sm text-muted-foreground">
                              Add this route to your Express application
                            </p>
                          </div>
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() => {
                              const code = getApiKeyNodeCode()
                              navigator.clipboard.writeText(code)
                              setCopiedCodeIndex(10)
                              setTimeout(() => setCopiedCodeIndex(null), 2000)
                            }}
                          >
                            {copiedCodeIndex === 10 ? (
                              <>
                                <Check className="h-4 w-4 mr-2" />
                                Copied!
                              </>
                            ) : (
                              <>
                                <Copy className="h-4 w-4 mr-2" />
                                Copy Code
                              </>
                            )}
                          </Button>
                        </div>
                        <div className="bg-muted p-4 rounded-lg overflow-x-auto">
                          <pre className="text-xs font-mono">
                            <code>{getApiKeyNodeCode()}</code>
                          </pre>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                          <p className="font-semibold text-blue-900 mb-1">Installation Steps:</p>
                          <ol className="list-decimal list-inside space-y-1 text-blue-800">
                            <li>Install node-fetch (or use built-in fetch in Node 18+): <code className="bg-blue-100 px-1 rounded">npm install node-fetch</code></li>
                            <li>Add the route to your Express app</li>
                            <li>Replace <code className="bg-blue-100 px-1 rounded">authenticateUser</code> with your auth middleware</li>
                            <li>Update <code className="bg-blue-100 px-1 rounded">WIDGET_SESSION_URL</code> with your domain</li>
                            <li>Add frontend code to load token when page loads</li>
                          </ol>
                        </div>
                      </div>
                    )}

                    {/* Python Code Example */}
                    {selectedApiKeyPlatform === 'python' && (
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="font-semibold mb-1">Python / Flask Integration</h4>
                            <p className="text-sm text-muted-foreground">
                              Add this route to your Flask application
                            </p>
                          </div>
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() => {
                              const code = getApiKeyPythonCode()
                              navigator.clipboard.writeText(code)
                              setCopiedCodeIndex(11)
                              setTimeout(() => setCopiedCodeIndex(null), 2000)
                            }}
                          >
                            {copiedCodeIndex === 11 ? (
                              <>
                                <Check className="h-4 w-4 mr-2" />
                                Copied!
                              </>
                            ) : (
                              <>
                                <Copy className="h-4 w-4 mr-2" />
                                Copy Code
                              </>
                            )}
                          </Button>
                        </div>
                        <div className="bg-muted p-4 rounded-lg overflow-x-auto">
                          <pre className="text-xs font-mono">
                            <code>{getApiKeyPythonCode()}</code>
                          </pre>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                          <p className="font-semibold text-blue-900 mb-1">Installation Steps:</p>
                          <ol className="list-decimal list-inside space-y-1 text-blue-800">
                            <li>Install requests: <code className="bg-blue-100 px-1 rounded">pip install requests</code></li>
                            <li>Add the route to your Flask app</li>
                            <li>Replace <code className="bg-blue-100 px-1 rounded">{'@'}require_auth</code> with your auth decorator</li>
                            <li>Update <code className="bg-blue-100 px-1 rounded">WIDGET_SESSION_URL</code> with your domain</li>
                            <li>Add frontend JavaScript to load token when page loads</li>
                          </ol>
                        </div>
                      </div>
                    )}

                    {/* WordPress Code Example */}
                    {selectedApiKeyPlatform === 'wordpress' && (
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="font-semibold mb-1">WordPress Integration</h4>
                            <p className="text-sm text-muted-foreground">
                              Add this to your theme&apos;s <code className="bg-muted px-1 rounded">functions.php</code> file
                            </p>
                          </div>
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() => {
                              const apiKeyValue = apiKey && apiKey !== 'exists' ? apiKey : 'YOUR_API_KEY'
                              const vendor = vendorId || 'YOUR_VENDOR_ID'
                              const code = `<?php
/**
 * Coupon Widget Token Generator for WordPress (API Key Method)
 * Add this to your theme's functions.php file
 */

function generate_coupon_widget_token() {
    // Configuration
    $vendor_id = '${vendor}';
    $api_key = '${apiKeyValue}';
    $widget_session_url = 'https://your-domain.com/api/widget-session';
    
    // Only generate token for logged-in users
    if (!is_user_logged_in()) {
        return;
    }
    
    $user_id = get_current_user_id();
    
    // Call our API to get widget session token
    $response = wp_remote_post($widget_session_url, array(
        'body' => json_encode(array(
            'api_key' => $api_key,
            'vendor_id' => $vendor_id,
            'user_id' => (string)$user_id,
        )),
        'headers' => array(
            'Content-Type' => 'application/json',
        ),
    ));
    
    if (is_wp_error($response)) {
        error_log('Coupon widget token generation failed: ' . $response->get_error_message());
        return;
    }
    
    $body = json_decode(wp_remote_retrieve_body($response), true);
    
    if (isset($body['success']) && $body['success'] && isset($body['data']['session_token'])) {
        $token = $body['data']['session_token'];
        
        // Send token to widget
        echo '<script>';
        echo 'if (typeof window.sendCouponToken === "function") {';
        echo '  window.sendCouponToken("' . esc_js($token) . '");';
        echo '}';
        echo '</script>';
    }
}

// Hook into wp_footer to inject token
add_action('wp_footer', 'generate_coupon_widget_token');`
                              navigator.clipboard.writeText(code)
                              setCopiedCodeIndex(12)
                              setTimeout(() => setCopiedCodeIndex(null), 2000)
                            }}
                          >
                            {copiedCodeIndex === 12 ? (
                              <>
                                <Check className="h-4 w-4 mr-2" />
                                Copied!
                              </>
                            ) : (
                              <>
                                <Copy className="h-4 w-4 mr-2" />
                                Copy Code
                              </>
                            )}
                          </Button>
                        </div>
                        <div className="bg-muted p-4 rounded-lg overflow-x-auto">
                          <pre className="text-xs font-mono">
                            <code>{`<?php
function generate_coupon_widget_token() {
    $vendor_id = '${vendorId}';
    $api_key = '${apiKey && apiKey !== 'exists' ? apiKey : 'YOUR_API_KEY'}';
    $widget_session_url = 'https://your-domain.com/api/widget-session';
    
    if (!is_user_logged_in()) return;
    
    $user_id = get_current_user_id();
    
    $response = wp_remote_post($widget_session_url, array(
        'body' => json_encode(array(
            'api_key' => $api_key,
            'vendor_id' => $vendor_id,
            'user_id' => (string)$user_id,
        )),
        'headers' => array('Content-Type' => 'application/json'),
    ));
    
    if (!is_wp_error($response)) {
        $body = json_decode(wp_remote_retrieve_body($response), true);
        if (isset($body['data']['session_token'])) {
            $token = $body['data']['session_token'];
            echo '<script>';
            echo 'if (typeof window.sendCouponToken === "function") {';
            echo '  window.sendCouponToken("' . esc_js($token) . '");';
            echo '}';
            echo '</script>';
        }
    }
}

add_action('wp_footer', 'generate_coupon_widget_token');`}</code>
                          </pre>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                          <p className="font-semibold text-blue-900 mb-1">Installation Steps:</p>
                          <ol className="list-decimal list-inside space-y-1 text-blue-800">
                            <li>Copy the code above to your theme&apos;s <code className="bg-blue-100 px-1 rounded">functions.php</code></li>
                            <li>Replace <code className="bg-blue-100 px-1 rounded">YOUR_API_KEY</code> with the API key from above</li>
                            <li>Update <code className="bg-blue-100 px-1 rounded">WIDGET_SESSION_URL</code> with your domain</li>
                            <li>Embed the widget script on pages where you want coupons displayed</li>
                          </ol>
                        </div>
                      </div>
                    )}

                    {/* Widget Embed Code */}
                    <div className="border-t pt-4 mt-4">
                      <h4 className="font-semibold mb-2">Widget Embed Code</h4>
                      <p className="text-sm text-muted-foreground mb-3">
                        Add this to your HTML pages where you want the coupon widget to appear:
                      </p>
                      <div className="flex items-center gap-2 mb-2">
                        <code className="flex-1 p-3 bg-muted rounded-lg font-mono text-xs">
                          {`<script src="${typeof window !== 'undefined' ? window.location.origin : 'https://your-domain.com'}/widget-embed.js"></script>
<div id="coupon-widget" data-vendor-id="${vendorId}"></div>`}
                        </code>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            const code = `<script src="${typeof window !== 'undefined' ? window.location.origin : 'https://your-domain.com'}/widget-embed.js"></script>
<div id="coupon-widget" data-vendor-id="${vendorId}"></div>`
                            navigator.clipboard.writeText(code)
                            setCopiedCodeIndex(13)
                            setTimeout(() => setCopiedCodeIndex(null), 2000)
                          }}
                        >
                          {copiedCodeIndex === 13 ? (
                            <>
                              <Check className="h-4 w-4 mr-2" />
                              Copied!
                            </>
                          ) : (
                            <>
                              <Copy className="h-4 w-4 mr-2" />
                              Copy
                            </>
                          )}
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ) : null}
            </TabsContent>

            {/* Tab 3: JWT Method (Existing Partner Secret Method) */}
            <TabsContent value="jwt" className="space-y-6 mt-6">
              {/* Partner Secret Management */}
              <Card>
                <CardHeader>
                  <div className="flex items-center justify-between">
                    <CardTitle className="flex items-center gap-2">
                      <Key className="h-5 w-5" />
                      Partner Secret (for JWT Token Signing)
                    </CardTitle>
                    <Button
                      onClick={generatePartnerSecret}
                      variant="outline"
                      size="sm"
                      disabled={generatingSecret}
                    >
                      {generatingSecret ? (
                        <>
                          <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                          Generating...
                        </>
                      ) : partnerSecret ? (
                        <>
                          <RefreshCw className="h-4 w-4 mr-2" />
                          Regenerate
                        </>
                      ) : (
                        <>
                          <Key className="h-4 w-4 mr-2" />
                          Generate Secret
                        </>
                      )}
                    </Button>
                  </div>
                  <CardDescription>
                    Partner secret is used to sign JWT tokens for widget authentication. Keep this secure and share only with the vendor.
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  {partnerSecret && partnerSecret !== 'exists' && showPartnerSecret ? (
                    <div className="space-y-4">
                      <div className="flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <AlertTriangle className="h-5 w-5 text-yellow-600" />
                        <p className="text-sm text-yellow-800">
                          <strong>Important:</strong> Copy this secret now. It will not be displayed again for security reasons.
                        </p>
                      </div>
                      <div className="flex items-center gap-2">
                        <code className="flex-1 p-3 bg-gray-100 rounded-lg font-mono text-sm break-all">
                          {partnerSecret}
                        </code>
                        <Button
                          onClick={copyPartnerSecret}
                          variant="outline"
                          size="sm"
                        >
                          {copiedSecret ? (
                            <>
                              <Check className="h-4 w-4 mr-2" />
                              Copied!
                            </>
                          ) : (
                            <>
                              <Copy className="h-4 w-4 mr-2" />
                              Copy
                            </>
                          )}
                        </Button>
                      </div>
                    </div>
                  ) : partnerSecret === 'exists' ? (
                    <div className="space-y-2">
                      <p className="text-sm text-muted-foreground">
                        Partner secret is configured. Click &quot;Regenerate&quot; to create a new one (this will invalidate the old secret).
                      </p>
                      <Button
                        onClick={() => {
                          if (confirm('This will show the current secret. Are you sure?')) {
                            fetchPartnerSecretStatus()
                          }
                        }}
                        variant="outline"
                        size="sm"
                      >
                        <Eye className="h-4 w-4 mr-2" />
                        View Secret (Last 4 chars only)
                      </Button>
                    </div>
                  ) : (
                    <div className="space-y-2">
                      <p className="text-sm text-muted-foreground">
                        No partner secret configured. Generate one to enable partner token authentication.
                      </p>
                    </div>
                  )}
                </CardContent>
              </Card>

              {/* Partner Integration Code Examples */}
              {(partnerSecret && partnerSecret !== 'exists' && showPartnerSecret) || partnerSecret === 'exists' ? (
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <FileCode className="h-5 w-5" />
                      Integration Code Examples
                    </CardTitle>
                    <CardDescription>
                      Copy these code examples and share with your partner. Replace placeholders with actual values from above.
                    </CardDescription>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {/* Platform Selector */}
                    <div className="flex gap-2 border-b pb-4">
                      <Button
                        variant={selectedPlatform === 'wordpress' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setSelectedPlatform('wordpress')}
                      >
                        WordPress (PHP)
                      </Button>
                      <Button
                        variant={selectedPlatform === 'nodejs' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setSelectedPlatform('nodejs')}
                      >
                        Node.js / Express
                      </Button>
                      <Button
                        variant={selectedPlatform === 'python' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setSelectedPlatform('python')}
                      >
                        Python / Flask
                      </Button>
                    </div>

                    {/* WordPress Code Example */}
                    {selectedPlatform === 'wordpress' && (
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="font-semibold mb-1">WordPress Integration</h4>
                            <p className="text-sm text-muted-foreground">
                              Add this to your theme&apos;s <code className="bg-muted px-1 rounded">functions.php</code> file
                            </p>
                          </div>
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() => {
                              const code = `<?php
/**
 * Coupon Widget Token Generator for WordPress
 * Add this to your theme's functions.php file
 */

use Firebase\\JWT\\JWT;
use Firebase\\JWT\\Key;

function generate_coupon_widget_token() {
    // Configuration - Replace with your values
    $vendor_id = '${vendorId}';
    $partner_secret = '${partnerSecret && partnerSecret !== 'exists' ? partnerSecret : 'YOUR_PARTNER_SECRET'}';
    
    // Only generate token for logged-in users
    if (!is_user_logged_in()) {
        return;
    }
    
    $external_user_id = get_current_user_id();
    $jti = 'jti-' . time() . '-' . wp_generate_password(12, false);
    
    $payload = [
        'vendor' => $vendor_id,
        'external_user_id' => (string)$external_user_id,
        'jti' => $jti,
        'iat' => time(),
        'exp' => time() + 180, // 3 minutes
    ];
    
    try {
        $token = JWT::encode($payload, $partner_secret, 'HS256');
        
        // Send token to widget
        echo '<script>';
        echo 'if (typeof window.sendCouponToken === "function") {';
        echo '  window.sendCouponToken("' . esc_js($token) . '");';
        echo '}';
        echo '</script>';
    } catch (Exception $e) {
        // Log error but don't break the page
        error_log('Coupon widget token generation failed: ' . $e->getMessage());
    }
}

// Hook into wp_footer to inject token
add_action('wp_footer', 'generate_coupon_widget_token');

// Note: Install Firebase JWT library via Composer:
// composer require firebase/php-jwt`
                              navigator.clipboard.writeText(code)
                              setCopiedCodeIndex(0)
                              setTimeout(() => setCopiedCodeIndex(null), 2000)
                            }}
                          >
                            {copiedCodeIndex === 0 ? (
                              <>
                                <Check className="h-4 w-4 mr-2" />
                                Copied!
                              </>
                            ) : (
                              <>
                                <Copy className="h-4 w-4 mr-2" />
                                Copy Code
                              </>
                            )}
                          </Button>
                        </div>
                        <div className="bg-muted p-4 rounded-lg overflow-x-auto">
                          <pre className="text-xs font-mono">
                            <code>{`<?php
use Firebase\\JWT\\JWT;

function generate_coupon_widget_token() {
    $vendor_id = '${vendorId}';
    $partner_secret = '${partnerSecret && partnerSecret !== 'exists' ? partnerSecret : 'YOUR_PARTNER_SECRET'}';
    
    if (!is_user_logged_in()) return;
    
    $external_user_id = get_current_user_id();
    $jti = 'jti-' . time() . '-' . wp_generate_password(12, false);
    
    $payload = [
        'vendor' => $vendor_id,
        'external_user_id' => (string)$external_user_id,
        'jti' => $jti,
        'iat' => time(),
        'exp' => time() + 180,
    ];
    
    try {
        $token = JWT::encode($payload, $partner_secret, 'HS256');
        echo '<script>';
        echo 'if (typeof window.sendCouponToken === "function") {';
        echo '  window.sendCouponToken("' . esc_js($token) . '");';
        echo '}';
        echo '</script>';
    } catch (Exception $e) {
        error_log('Coupon widget token generation failed: ' . $e->getMessage());
    }
}

add_action('wp_footer', 'generate_coupon_widget_token');`}</code>
                          </pre>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                          <p className="font-semibold text-blue-900 mb-1">Installation Steps:</p>
                          <ol className="list-decimal list-inside space-y-1 text-blue-800">
                            <li>Install Firebase JWT: <code className="bg-blue-100 px-1 rounded">composer require firebase/php-jwt</code></li>
                            <li>Copy the code above to your theme&apos;s <code className="bg-blue-100 px-1 rounded">functions.php</code></li>
                            <li>Replace <code className="bg-blue-100 px-1 rounded">YOUR_PARTNER_SECRET</code> with the secret from above</li>
                            <li>Embed the widget script on pages where you want coupons displayed</li>
                          </ol>
                        </div>
                      </div>
                    )}

                    {/* Node.js Code Example */}
                    {selectedPlatform === 'nodejs' && (
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="font-semibold mb-1">Node.js / Express Integration</h4>
                            <p className="text-sm text-muted-foreground">
                              Add this route to your Express application
                            </p>
                          </div>
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() => {
                              const code = `const jwt = require('jsonwebtoken');

// Configuration
const vendorId = '${vendorId}';
const partnerSecret = '${partnerSecret && partnerSecret !== 'exists' ? partnerSecret : 'YOUR_PARTNER_SECRET'}';

app.get('/api/coupon-token', authenticateUser, (req, res) => {
  try {
    const externalUserId = req.user.id.toString();
    const jti = \`jti-\${Date.now()}-\${Math.random().toString(36).substring(2, 15)}\`;
    
    const token = jwt.sign(
      {
        vendor: vendorId,
        external_user_id: externalUserId,
        jti: jti,
      },
      partnerSecret,
      {
        algorithm: 'HS256',
        expiresIn: '3m',
      }
    );
    
    res.json({ token });
  } catch (error) {
    console.error('Error generating coupon token:', error);
    res.status(500).json({ error: 'Failed to generate token' });
  }
});

// Frontend: Fetch token and send to widget
async function loadCouponWidget() {
  try {
    const response = await fetch('/api/coupon-token', {
      credentials: 'include',
    });
    const data = await response.json();
    
    if (data.token && typeof window.sendCouponToken === "function") {
      window.sendCouponToken(data.token);
    }
  } catch (error) {
    console.error('Failed to load coupon widget token:', error);
  }
}

loadCouponWidget();`
                              navigator.clipboard.writeText(code)
                              setCopiedCodeIndex(1)
                              setTimeout(() => setCopiedCodeIndex(null), 2000)
                            }}
                          >
                            {copiedCodeIndex === 1 ? (
                              <>
                                <Check className="h-4 w-4 mr-2" />
                                Copied!
                              </>
                            ) : (
                              <>
                                <Copy className="h-4 w-4 mr-2" />
                                Copy Code
                              </>
                            )}
                          </Button>
                        </div>
                        <div className="bg-muted p-4 rounded-lg overflow-x-auto">
                          <pre className="text-xs font-mono">
                            <code>{`const jwt = require('jsonwebtoken');

const vendorId = '${vendorId}';
const partnerSecret = '${partnerSecret && partnerSecret !== 'exists' ? partnerSecret : 'YOUR_PARTNER_SECRET'}';

app.get('/api/coupon-token', authenticateUser, (req, res) => {
  try {
    const externalUserId = req.user.id.toString();
    const jti = \`jti-\${Date.now()}-\${Math.random().toString(36).substring(2, 15)}\`;
    
    const token = jwt.sign(
      {
        vendor: vendorId,
        external_user_id: externalUserId,
        jti: jti,
      },
      partnerSecret,
      { algorithm: 'HS256', expiresIn: '3m' }
    );
    
    res.json({ token });
  } catch (error) {
    res.status(500).json({ error: 'Failed to generate token' });
  }
});`}</code>
                          </pre>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                          <p className="font-semibold text-blue-900 mb-1">Installation Steps:</p>
                          <ol className="list-decimal list-inside space-y-1 text-blue-800">
                            <li>Install jsonwebtoken: <code className="bg-blue-100 px-1 rounded">npm install jsonwebtoken</code></li>
                            <li>Add the route to your Express app</li>
                            <li>Replace <code className="bg-blue-100 px-1 rounded">authenticateUser</code> with your auth middleware</li>
                            <li>Add the frontend code to load the token when page loads</li>
                          </ol>
                        </div>
                      </div>
                    )}

                    {/* Python Code Example */}
                    {selectedPlatform === 'python' && (
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <h4 className="font-semibold mb-1">Python / Flask Integration</h4>
                            <p className="text-sm text-muted-foreground">
                              Add this route to your Flask application
                            </p>
                          </div>
                          <Button
                            variant="outline"
                            size="sm"
                            onClick={() => {
                              const code = getPythonCode()
                              navigator.clipboard.writeText(code)
                              setCopiedCodeIndex(2)
                              setTimeout(() => setCopiedCodeIndex(null), 2000)
                            }}
                          >
                            {copiedCodeIndex === 2 ? (
                              <>
                                <Check className="h-4 w-4 mr-2" />
                                Copied!
                              </>
                            ) : (
                              <>
                                <Copy className="h-4 w-4 mr-2" />
                                Copy Code
                              </>
                            )}
                          </Button>
                        </div>
                        <div className="bg-muted p-4 rounded-lg overflow-x-auto">
                          <pre className="text-xs font-mono">
                            <code>{getPythonCode()}</code>
                          </pre>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                          <p className="font-semibold text-blue-900 mb-1">Installation Steps:</p>
                          <ol className="list-decimal list-inside space-y-1 text-blue-800">
                            <li>Install PyJWT: <code className="bg-blue-100 px-1 rounded">pip install PyJWT</code></li>
                            <li>Add the route to your Flask app</li>
                            <li>Replace <code className="bg-blue-100 px-1 rounded">{'@'}require_auth</code> with your auth decorator</li>
                            <li>Add frontend JavaScript to load token when page loads</li>
                          </ol>
                        </div>
                      </div>
                    )}

                    {/* Widget Embed Code */}
                    <div className="border-t pt-4 mt-4">
                      <h4 className="font-semibold mb-2">Widget Embed Code</h4>
                      <p className="text-sm text-muted-foreground mb-3">
                        Add this to your HTML pages where you want the coupon widget to appear:
                      </p>
                      <div className="flex items-center gap-2 mb-2">
                        <code className="flex-1 p-3 bg-muted rounded-lg font-mono text-xs">
                          {`<script src="${typeof window !== 'undefined' ? window.location.origin : 'https://your-domain.com'}/widget-embed.js"></script>
<div id="coupon-widget" data-vendor-id="${vendorId}"></div>`}
                        </code>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            const code = `<script src="${typeof window !== 'undefined' ? window.location.origin : 'https://your-domain.com'}/widget-embed.js"></script>
<div id="coupon-widget" data-vendor-id="${vendorId}"></div>`
                            navigator.clipboard.writeText(code)
                            setCopiedCodeIndex(3)
                            setTimeout(() => setCopiedCodeIndex(null), 2000)
                          }}
                        >
                          {copiedCodeIndex === 3 ? (
                            <>
                              <Check className="h-4 w-4 mr-2" />
                              Copied!
                            </>
                          ) : (
                            <>
                              <Copy className="h-4 w-4 mr-2" />
                              Copy
                            </>
                          )}
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ) : null}
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>

